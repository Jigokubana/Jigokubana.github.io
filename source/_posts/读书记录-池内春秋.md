---
title: 池内春秋
tags:
  - null
categories:
  - 读书记录
date: 2020-10-06 12:17:39
---

[google 图书 - 内存池设计哲学](https://docs.google.com/viewer?a=v&pid=forums&srcid=MTc2ODU2ODcyNjk2NTM2NDM0NzcBMDk3MzkxODQwNzQ0NDE2OTE1NjcBQ2dMdWoyeWxLWU1KATAuMQEBdjI)


C++平台提供的内存配置工具

| 配置            | 释放              | 归属      | 可重载         | 标记 |
| --------------- | ----------------- | --------- | -------------- | ---- |
| malloc          | free              | C标准式子 | 否             | #1   |
| new             | delete            | C++表达式 | 否             | #2   |
| ::operator new  | ::operator delete | C++运算符 | 可             | #3   |
| alloc::allocate | alloc::deallocate | C++标准库 | 编译器厂商设计 | #4   |

1. #2会调用 #3来实现功能一部分
2. #1和#3功能相同
3. #4相当于#1或者#3
4. #2会在 使用#3分配内存后调用对应的构造函数(调用#3释放内存前调用对应的析构函数)


#1 #2 #3 在释放的时候不需要传入大小是因为 在配置的内存前方存在8字节的配置信息 可能直接是大小也可能是其他相关内容其中包含大小

#4 则需要在释放的时候传入大小 因为分配的内存中不包含大小

使用方式

```c++
#include <memory>

#define SIZE 512

int main()
{
    void* ptr1 = malloc(SIZE);
    free(ptr1);

    char* ptr2 = new char[SIZE];
    delete[] ptr2;

    void* ptr3 = ::operator new(SIZE);
    ::operator delete(ptr3);

    std::allocator<char> alloc;
    char* ptr4 = alloc.allocate(SIZE);
    alloc.deallocate(ptr4, SIZE);
}
```
